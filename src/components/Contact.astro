---

---

<section id='contact' class='py-16 bg-white'>
  <div class='max-w-3xl mx-auto px-4 sm:px-6 lg:px-8'>
    <h2
      class='text-3xl font-arabic text-center text-emerald-900 mb-8'
      data-aos='fade-up'
    >
      Get in Touch
    </h2>
    <p
      class='text-center text-gray-600 mb-8'
      data-aos='fade-up'
      data-aos-delay='100'
    >
      Take the first step towards your mental and spiritual well-being. Schedule
      a consultation or ask any questions you may have.
    </p>

    <!-- Success/Error Messages -->
    <div id='form-messages' class='mb-6 hidden'>
      <div
        id='success-message'
        class='hidden bg-emerald-50 border border-emerald-200 rounded-lg p-6 mb-4'
      >
        <div class='text-center'>
          <svg
            class='w-16 h-16 text-emerald-600 mx-auto mb-4'
            fill='currentColor'
            viewBox='0 0 20 20'
          >
            <path
              fill-rule='evenodd'
              d='M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z'
              clip-rule='evenodd'></path>
          </svg>
          <h3 class='text-xl font-semibold text-emerald-900 mb-2'>
            Message Sent Successfully!
          </h3>
          <p class='text-emerald-800 font-medium mb-4' id='success-text'></p>
          <p class='text-emerald-700 text-sm mb-6'>
            We've received your message and will get back to you as soon as
            possible. Thank you for reaching out to us!
          </p>
          <button
            id='send-another-btn'
            class='inline-flex items-center justify-center rounded-full border border-emerald-600 bg-white py-2 px-6 text-emerald-600 hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-all hover:scale-105 text-sm font-medium'
          >
            <svg
              class='w-4 h-4 mr-2'
              fill='none'
              stroke='currentColor'
              viewBox='0 0 24 24'
            >
              <path
                stroke-linecap='round'
                stroke-linejoin='round'
                stroke-width='2'
                d='M12 6v6m0 0v6m0-6h6m-6 0H6'></path>
            </svg>
            Send Another Message
          </button>
        </div>
      </div>
      <div
        id='error-message'
        class='hidden bg-red-50 border border-red-200 rounded-lg p-4 mb-4'
      >
        <div class='flex items-center'>
          <svg
            class='w-5 h-5 text-red-600 mr-2'
            fill='currentColor'
            viewBox='0 0 20 20'
          >
            <path
              fill-rule='evenodd'
              d='M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z'
              clip-rule='evenodd'></path>
          </svg>
          <span class='text-red-800 font-medium' id='error-text'></span>
        </div>
      </div>
    </div>

    <div id='form-container' class='transition-all duration-300'>
      <form
        id='contact-form'
        class='space-y-6'
        data-aos='fade-up'
        data-aos-delay='200'
        novalidate
      >
        <!-- Honeypot field (hidden from users, bots might fill it) -->
        <input
          type='text'
          name='website'
          style='position: absolute; left: -9999px; opacity: 0; pointer-events: none;'
          tabindex='-1'
          autocomplete='off'
          aria-hidden='true'
        />

        <div class='grid grid-cols-1 gap-6 sm:grid-cols-2'>
          <div class='transform transition-all focus-within:scale-[1.01]'>
            <label for='name' class='block text-sm font-medium text-gray-700'
              >Name <span class='text-red-500'>*</span></label
            >
            <input
              type='text'
              id='name'
              name='name'
              required
              minlength='2'
              maxlength='100'
              pattern="[A-Za-z\s'-]+"
              class='mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500'
              autocomplete='name'
            />
            <div
              class='invalid-feedback text-red-600 text-sm mt-1 hidden'
              id='name-error'
            >
            </div>
          </div>
          <div class='transform transition-all focus-within:scale-[1.01]'>
            <label for='email' class='block text-sm font-medium text-gray-700'
              >Email <span class='text-red-500'>*</span></label
            >
            <input
              type='email'
              id='email'
              name='email'
              required
              maxlength='254'
              class='mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500'
              autocomplete='email'
            />
            <div
              class='invalid-feedback text-red-600 text-sm mt-1 hidden'
              id='email-error'
            >
            </div>
          </div>
        </div>
        <div class='transform transition-all focus-within:scale-[1.01]'>
          <label for='phone' class='block text-sm font-medium text-gray-700'
            >Phone Number</label
          >
          <input
            type='tel'
            id='phone'
            name='phone'
            class='mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500'
          />
        </div>
        <div class='transform transition-all focus-within:scale-[1.01]'>
          <label for='service' class='block text-sm font-medium text-gray-700'
            >Service Interested In</label
          >
          <select
            id='service'
            name='service'
            class='mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500'
          >
            <option value=''>Select a service</option>
            <option value='family'>Family Counseling</option>
            <option value='youth'>Youth Intervention</option>
            <option value='spiritual'>Spiritual Therapy</option>
            <option value='crisis'>Crisis Intervention</option>
            <option value='psychotherapy'>Psychotherapy</option>
            <option value='career'>Career Counseling</option>
          </select>
        </div>
        <div class='transform transition-all focus-within:scale-[1.01]'>
          <label for='message' class='block text-sm font-medium text-gray-700'
            >Message <span class='text-red-500'>*</span></label
          >
          <textarea
            id='message'
            name='message'
            required
            minlength='10'
            maxlength='2000'
            rows='4'
            class='mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500'
            placeholder='Please describe how we can help you...'></textarea>
          <div
            class='invalid-feedback text-red-600 text-sm mt-1 hidden'
            id='message-error'
          >
          </div>
          <div class='text-right text-xs text-gray-500 mt-1'>
            <span id='char-count'>0</span>/2000 characters
          </div>
        </div>
        <div class='text-center'>
          <button
            type='submit'
            id='submit-btn'
            class='inline-flex justify-center rounded-full border border-transparent bg-emerald-600 py-3 px-8 text-white hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-all hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed'
          >
            <span id='submit-text'>Send Message</span>
            <svg
              id='loading-spinner'
              class='hidden animate-spin ml-2 h-5 w-5 text-white'
              xmlns='http://www.w3.org/2000/svg'
              fill='none'
              viewBox='0 0 24 24'
            >
              <circle
                class='opacity-25'
                cx='12'
                cy='12'
                r='10'
                stroke='currentColor'
                stroke-width='4'></circle>
              <path
                class='opacity-75'
                fill='currentColor'
                d='m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'
              ></path>
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const submitBtn = document.getElementById(
      'submit-btn'
    ) as HTMLButtonElement;
    const submitText = document.getElementById(
      'submit-text'
    ) as HTMLSpanElement;
    const loadingSpinner = document.getElementById(
      'loading-spinner'
    ) as HTMLElement;
    const messageTextarea = document.getElementById(
      'message'
    ) as HTMLTextAreaElement;
    const charCount = document.getElementById('char-count') as HTMLSpanElement;
    const formMessages = document.getElementById(
      'form-messages'
    ) as HTMLElement;
    const successMessage = document.getElementById(
      'success-message'
    ) as HTMLElement;
    const errorMessage = document.getElementById(
      'error-message'
    ) as HTMLElement;
    const successText = document.getElementById(
      'success-text'
    ) as HTMLSpanElement;
    const errorText = document.getElementById('error-text') as HTMLSpanElement;

    // Character count for message
    messageTextarea.addEventListener('input', function () {
      const count = this.value.length;
      charCount.textContent = count.toString();

      if (count > 2000) {
        charCount.style.color = '#dc2626'; // red-600
        this.style.borderColor = '#dc2626';
      } else {
        charCount.style.color = '#6b7280'; // gray-500
        this.style.borderColor = '';
      }
    });

    // Real-time validation
    const validateField = (field: HTMLInputElement | HTMLTextAreaElement) => {
      const errorElement = document.getElementById(`${field.id}-error`);
      let isValid = true;
      let errorMsg = '';

      // Clear previous errors
      field.classList.remove('border-red-500');
      if (errorElement) {
        errorElement.classList.add('hidden');
        errorElement.textContent = '';
      }

      // Name validation
      if (field.id === 'name') {
        const name = field.value.trim();
        if (!name) {
          errorMsg = 'Name is required';
          isValid = false;
        } else if (name.length < 2) {
          errorMsg = 'Name must be at least 2 characters';
          isValid = false;
        } else if (name.length > 100) {
          errorMsg = 'Name must be less than 100 characters';
          isValid = false;
        } else if (!/^[a-zA-Z\s'-]+$/.test(name)) {
          errorMsg =
            'Name can only contain letters, spaces, hyphens, and apostrophes';
          isValid = false;
        }
      }

      // Email validation
      if (field.id === 'email') {
        const email = field.value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email) {
          errorMsg = 'Email is required';
          isValid = false;
        } else if (!emailRegex.test(email)) {
          errorMsg = 'Please enter a valid email address';
          isValid = false;
        } else if (email.length > 254) {
          errorMsg = 'Email address is too long';
          isValid = false;
        }
      }

      // Message validation
      if (field.id === 'message') {
        const message = field.value.trim();
        if (!message) {
          errorMsg = 'Message is required';
          isValid = false;
        } else if (message.length < 10) {
          errorMsg = 'Message must be at least 10 characters';
          isValid = false;
        } else if (message.length > 2000) {
          errorMsg = 'Message must be less than 2000 characters';
          isValid = false;
        }
      }

      if (!isValid && errorElement) {
        field.classList.add('border-red-500');
        errorElement.textContent = errorMsg;
        errorElement.classList.remove('hidden');
      }

      return isValid;
    };

    // Add blur validation to required fields
    ['name', 'email', 'message'].forEach(fieldId => {
      const field = document.getElementById(fieldId) as
        | HTMLInputElement
        | HTMLTextAreaElement;
      if (field) {
        field.addEventListener('blur', () => validateField(field));
        field.addEventListener('input', () => {
          // Clear error on input
          const errorElement = document.getElementById(`${fieldId}-error`);
          if (errorElement && !errorElement.classList.contains('hidden')) {
            validateField(field);
          }
        });
      }
    });

    // Form submission
    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      // Validate all fields
      const nameField = document.getElementById('name') as HTMLInputElement;
      const emailField = document.getElementById('email') as HTMLInputElement;
      const messageField = document.getElementById(
        'message'
      ) as HTMLTextAreaElement;

      const isNameValid = validateField(nameField);
      const isEmailValid = validateField(emailField);
      const isMessageValid = validateField(messageField);

      if (!isNameValid || !isEmailValid || !isMessageValid) {
        showError('Please fix the errors above before submitting.');
        return;
      }

      // Show loading state
      setLoadingState(true);
      hideMessages();

      try {
        const formData = new FormData(form);

        const response = await fetch('/api/contact', {
          method: 'POST',
          body: formData,
        });

        const result = await response.json();

        if (response.ok && result.success) {
          showSuccess(
            result.message || 'Your message has been sent successfully!'
          );
        } else {
          if (response.status === 429) {
            showError(
              `Too many requests. Please try again in ${result.retryAfter || 15} minutes.`
            );
          } else {
            showError(
              result.error || 'Failed to send message. Please try again.'
            );
          }
        }
      } catch (error) {
        console.error('Form submission error:', error);
        showError('Network error. Please check your connection and try again.');
      } finally {
        setLoadingState(false);
      }
    });

    function setLoadingState(loading: boolean) {
      submitBtn.disabled = loading;
      if (loading) {
        submitText.textContent = 'Sending...';
        loadingSpinner.classList.remove('hidden');
      } else {
        submitText.textContent = 'Send Message';
        loadingSpinner.classList.add('hidden');
      }
    }

    function showSuccess(message: string) {
      successText.textContent = message;
      successMessage.classList.remove('hidden');
      errorMessage.classList.add('hidden');
      formMessages.classList.remove('hidden');

      // Hide the form with smooth animation
      const formContainer = document.getElementById(
        'form-container'
      ) as HTMLElement;
      if (formContainer) {
        formContainer.style.opacity = '0';
        formContainer.style.transform = 'translateY(-20px)';
        setTimeout(() => {
          formContainer.style.display = 'none';
        }, 300);
      }

      // Scroll to message
      formMessages.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function showError(message: string) {
      errorText.textContent = message;
      errorMessage.classList.remove('hidden');
      successMessage.classList.add('hidden');
      formMessages.classList.remove('hidden');

      // Ensure form is visible for errors
      showForm();

      // Scroll to message
      formMessages.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function showForm() {
      const formContainer = document.getElementById(
        'form-container'
      ) as HTMLElement;
      if (formContainer) {
        formContainer.style.display = 'block';
        formContainer.style.opacity = '1';
        formContainer.style.transform = 'translateY(0)';
      }
    }

    function resetForm() {
      // Hide messages
      hideMessages();

      // Show form again with animation
      showForm();

      // Reset form fields
      form.reset();
      charCount.textContent = '0';

      // Clear any validation errors
      const errorElements = form.querySelectorAll('.invalid-feedback');
      errorElements.forEach(el => el.classList.add('hidden'));

      // Remove error styling from fields
      const fields = form.querySelectorAll('input, textarea, select');
      fields.forEach(field => field.classList.remove('border-red-500'));
    }

    // Add event listener for "Send Another Message" button
    document.addEventListener('click', function (e) {
      if (e.target && (e.target as HTMLElement).id === 'send-another-btn') {
        resetForm();

        // Scroll back to form
        const formContainer = document.getElementById('form-container');
        if (formContainer) {
          formContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
    });

    function hideMessages() {
      formMessages.classList.add('hidden');
      successMessage.classList.add('hidden');
      errorMessage.classList.add('hidden');
    }
  });
</script>
